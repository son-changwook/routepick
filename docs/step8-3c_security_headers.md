# Step 8-3c: Î≥¥Ïïà Ìó§Îçî ÏÑ§Ï†ï Íµ¨ÌòÑ

> HTTP Î≥¥Ïïà Ìó§Îçî Î∞è Content Security Policy Íµ¨ÌòÑ  
> ÏÉùÏÑ±Ïùº: 2025-08-26  
> Í∏∞Î∞ò ÌååÏùº: step7-1f_xss_security.md, step8-1d_jwt_properties.md

---

## üéØ Íµ¨ÌòÑ Î™©Ìëú

- **Ï¢ÖÌï© Î≥¥Ïïà Ìó§Îçî**: XSS, ÌÅ¥Î¶≠Ïû¨ÌÇπ, MIME Ïä§ÎãàÌïë Î∞©ÏßÄ
- **Content Security Policy**: ÎèôÏ†Å CSP Ï†ïÏ±Ö Í¥ÄÎ¶¨
- **HSTS ÏÑ§Ï†ï**: HTTPS Í∞ïÏ†ú Î∞è Î≥¥Ïïà Ï†ÑÏÜ°
- **ÌôòÍ≤ΩÎ≥Ñ Ï†ïÏ±Ö**: Í∞úÎ∞ú/ÌîÑÎ°úÎçïÏÖò ÌôòÍ≤ΩÎ≥Ñ Ìó§Îçî ÏÑ§Ï†ï
- **Ìó§Îçî Î™®ÎãàÌÑ∞ÎßÅ**: Î≥¥Ïïà Ìó§Îçî Ï§ÄÏàò ÏÉÅÌÉú Ï∂îÏ†Å

---

## üõ°Ô∏è 1. SecurityHeadersFilter Íµ¨ÌòÑ

### SecurityHeadersFilter.java
```java
package com.routepick.filter.security;

import com.routepick.config.security.SecurityHeadersProperties;
import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.core.Ordered;
import org.springframework.core.annotation.Order;
import org.springframework.core.env.Environment;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import java.io.IOException;
import java.util.Arrays;

/**
 * Î≥¥Ïïà Ìó§Îçî ÌïÑÌÑ∞
 * - Î™®Îì† HTTP ÏùëÎãµÏóê Î≥¥Ïïà Ìó§Îçî Ï∂îÍ∞Ä
 * - ÌôòÍ≤ΩÎ≥Ñ ÎèôÏ†Å Ìó§Îçî ÏÑ§Ï†ï
 * - CSP Ï†ïÏ±Ö Ï†ÅÏö©
 */
@Slf4j
@Component
@Order(Ordered.HIGHEST_PRECEDENCE + 1)
@RequiredArgsConstructor
public class SecurityHeadersFilter extends OncePerRequestFilter {
    
    private final SecurityHeadersProperties securityHeadersProperties;
    private final Environment environment;
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                  HttpServletResponse response,
                                  FilterChain filterChain) throws ServletException, IOException {
        
        // Í∏∞Î≥∏ Î≥¥Ïïà Ìó§Îçî ÏÑ§Ï†ï
        setBasicSecurityHeaders(response);
        
        // Content Security Policy ÏÑ§Ï†ï
        setContentSecurityPolicy(response, request);
        
        // HSTS ÏÑ§Ï†ï (HTTPSÏóêÏÑúÎßå)
        if (isSecureRequest(request)) {
            setHstsHeader(response);
        }
        
        // ÌôòÍ≤ΩÎ≥Ñ Ï∂îÍ∞Ä Ìó§Îçî
        setEnvironmentSpecificHeaders(response);
        
        // API ÏùëÎãµ ÌäπÌôî Ìó§Îçî
        if (request.getRequestURI().startsWith("/api/")) {
            setApiSecurityHeaders(response);
        }
        
        filterChain.doFilter(request, response);
    }
    
    /**
     * Í∏∞Î≥∏ Î≥¥Ïïà Ìó§Îçî ÏÑ§Ï†ï
     */
    private void setBasicSecurityHeaders(HttpServletResponse response) {
        // X-Frame-Options: ÌÅ¥Î¶≠Ïû¨ÌÇπ Î∞©ÏßÄ
        response.setHeader("X-Frame-Options", "DENY");
        
        // X-Content-Type-Options: MIME Ïä§ÎãàÌïë Î∞©ÏßÄ
        response.setHeader("X-Content-Type-Options", "nosniff");
        
        // X-XSS-Protection: XSS ÌïÑÌÑ∞ ÌôúÏÑ±Ìôî (Î†àÍ±∞Ïãú Î∏åÎùºÏö∞Ï†ÄÏö©)
        response.setHeader("X-XSS-Protection", "1; mode=block");
        
        // Referrer-Policy: Î†àÌçºÎü¨ Ï†ïÎ≥¥ Ï†úÌïú
        response.setHeader("Referrer-Policy", "strict-origin-when-cross-origin");
        
        // Permissions-Policy: Î∏åÎùºÏö∞Ï†Ä Í∏∞Îä• Ï†úÌïú
        response.setHeader("Permissions-Policy", 
            "camera=(), microphone=(), geolocation=(self), payment=()");
        
        // X-Download-Options: ÌååÏùº Îã§Ïö¥Î°úÎìú Î≥¥Ïïà (IEÏö©)
        response.setHeader("X-Download-Options", "noopen");
        
        // X-Permitted-Cross-Domain-Policies: Flash Ï†ïÏ±Ö Ï†úÌïú
        response.setHeader("X-Permitted-Cross-Domain-Policies", "none");
    }
    
    /**
     * Content Security Policy ÏÑ§Ï†ï
     */
    private void setContentSecurityPolicy(HttpServletResponse response, HttpServletRequest request) {
        String requestUri = request.getRequestURI();
        
        if (requestUri.startsWith("/api/")) {
            // API Ï†ÑÏö© CSP (Îß§Ïö∞ Ï†úÌïúÏ†Å)
            response.setHeader("Content-Security-Policy", 
                "default-src 'none'; " +
                "script-src 'none'; " +
                "object-src 'none'; " +
                "base-uri 'none'; " +
                "frame-ancestors 'none'");
        } else if (requestUri.startsWith("/admin/")) {
            // Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ CSP
            response.setHeader("Content-Security-Policy", getAdminCspPolicy());
        } else {
            // ÏùºÎ∞ò Ïõπ ÌéòÏù¥ÏßÄ CSP
            response.setHeader("Content-Security-Policy", getWebCspPolicy());
        }
        
        // CSP ÏúÑÎ∞ò Î¶¨Ìè¨Ìä∏ ÏÑ§Ï†ï
        if (securityHeadersProperties.getCsp().isReportingEnabled()) {
            response.setHeader("Content-Security-Policy-Report-Only", 
                getCspPolicyWithReporting());
        }
    }
    
    /**
     * HSTS Ìó§Îçî ÏÑ§Ï†ï
     */
    private void setHstsHeader(HttpServletResponse response) {
        if (isProdEnvironment()) {
            // ÌîÑÎ°úÎçïÏÖò: 1ÎÖÑ, includeSubDomains, preload
            response.setHeader("Strict-Transport-Security", 
                "max-age=31536000; includeSubDomains; preload");
        } else {
            // Í∞úÎ∞ú/Ïä§ÌÖåÏù¥Ïßï: ÏßßÏùÄ Í∏∞Í∞Ñ
            response.setHeader("Strict-Transport-Security", 
                "max-age=86400; includeSubDomains");
        }
    }
    
    /**
     * ÌôòÍ≤ΩÎ≥Ñ ÌäπÌôî Ìó§Îçî
     */
    private void setEnvironmentSpecificHeaders(HttpServletResponse response) {
        if (isProdEnvironment()) {
            // ÌîÑÎ°úÎçïÏÖò ÌôòÍ≤Ω: ÏÑúÎ≤Ñ Ï†ïÎ≥¥ Ïà®ÍπÄ
            response.setHeader("Server", "RoutePickr");
            response.setHeader("X-Powered-By", ""); // Îπà Í∞íÏúºÎ°ú ÏÑ§Ï†ï
        } else {
            // Í∞úÎ∞ú ÌôòÍ≤Ω: ÎîîÎ≤ÑÍπÖ Ìó§Îçî Ï∂îÍ∞Ä
            response.setHeader("X-Environment", getCurrentEnvironment());
            response.setHeader("X-Debug-Mode", "enabled");
        }
    }
    
    /**
     * API Ï†ÑÏö© Î≥¥Ïïà Ìó§Îçî
     */
    private void setApiSecurityHeaders(HttpServletResponse response) {
        // Cache-Control: API ÏùëÎãµ Ï∫êÏãú Î∞©ÏßÄ
        response.setHeader("Cache-Control", 
            "no-store, no-cache, must-revalidate, max-age=0");
        response.setHeader("Pragma", "no-cache");
        response.setHeader("Expires", "0");
        
        // API Î≤ÑÏ†Ñ Ìó§Îçî
        response.setHeader("X-API-Version", "v1");
        
        // ÏΩòÌÖêÏ∏† ÌÉÄÏûÖ Í∞ïÏ†ú
        if (!response.containsHeader("Content-Type")) {
            response.setHeader("Content-Type", "application/json; charset=UTF-8");
        }
    }
    
    /**
     * Ïõπ ÌéòÏù¥ÏßÄÏö© CSP Ï†ïÏ±Ö
     */
    private String getWebCspPolicy() {
        return "default-src 'self'; " +
               "script-src 'self' 'unsafe-inline' https://www.google.com/recaptcha/ " +
               "https://www.gstatic.com/recaptcha/ https://apis.google.com; " +
               "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; " +
               "font-src 'self' https://fonts.gstatic.com; " +
               "img-src 'self' data: https: blob:; " +
               "connect-src 'self' https://api.routepick.co.kr; " +
               "frame-src https://www.google.com/recaptcha/; " +
               "object-src 'none'; " +
               "base-uri 'self'; " +
               "form-action 'self'; " +
               "frame-ancestors 'none'";
    }
    
    /**
     * Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÏö© CSP Ï†ïÏ±Ö
     */
    private String getAdminCspPolicy() {
        return "default-src 'self'; " +
               "script-src 'self' 'unsafe-inline'; " +
               "style-src 'self' 'unsafe-inline'; " +
               "font-src 'self' data:; " +
               "img-src 'self' data: https:; " +
               "connect-src 'self' https://admin-api.routepick.co.kr; " +
               "object-src 'none'; " +
               "base-uri 'self'; " +
               "form-action 'self'; " +
               "frame-ancestors 'none'";
    }
    
    /**
     * CSP Î¶¨Ìè¨ÌåÖ Ìè¨Ìï® Ï†ïÏ±Ö
     */
    private String getCspPolicyWithReporting() {
        return getWebCspPolicy() + "; report-uri /api/v1/security/csp-report";
    }
    
    /**
     * HTTPS ÏöîÏ≤≠ Ïó¨Î∂Ä ÌôïÏù∏
     */
    private boolean isSecureRequest(HttpServletRequest request) {
        return request.isSecure() || 
               "https".equalsIgnoreCase(request.getHeader("X-Forwarded-Proto")) ||
               "https".equalsIgnoreCase(request.getHeader("X-Forwarded-Scheme"));
    }
    
    /**
     * ÌîÑÎ°úÎçïÏÖò ÌôòÍ≤Ω Ïó¨Î∂Ä
     */
    private boolean isProdEnvironment() {
        return Arrays.asList(environment.getActiveProfiles()).contains("prod");
    }
    
    /**
     * ÌòÑÏû¨ ÌôòÍ≤Ω Ï°∞Ìöå
     */
    private String getCurrentEnvironment() {
        String[] profiles = environment.getActiveProfiles();
        return profiles.length > 0 ? profiles[0] : "default";
    }
}
```

---

## ‚öôÔ∏è 2. SecurityHeadersProperties ÏÑ§Ï†ï

### SecurityHeadersProperties.java
```java
package com.routepick.config.security;

import lombok.Data;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.validation.annotation.Validated;

import jakarta.validation.constraints.NotNull;
import java.util.List;
import java.util.Map;

/**
 * Î≥¥Ïïà Ìó§Îçî ÏÑ§Ï†ï ÌîÑÎ°úÌçºÌã∞
 */
@Data
@Validated
@ConfigurationProperties(prefix = "app.security.headers")
public class SecurityHeadersProperties {
    
    @NotNull
    private CspConfig csp = new CspConfig();
    
    @NotNull
    private HstsConfig hsts = new HstsConfig();
    
    @NotNull
    private FrameOptionsConfig frameOptions = new FrameOptionsConfig();
    
    private Map<String, String> customHeaders;
    
    @Data
    public static class CspConfig {
        private boolean enabled = true;
        private boolean reportingEnabled = false;
        private String reportUri = "/api/v1/security/csp-report";
        private List<String> scriptSources = List.of("'self'", "'unsafe-inline'");
        private List<String> styleSources = List.of("'self'", "'unsafe-inline'");
        private List<String> fontSources = List.of("'self'", "https://fonts.gstatic.com");
        private List<String> imageSources = List.of("'self'", "data:", "https:");
        private List<String> connectSources = List.of("'self'");
    }
    
    @Data
    public static class HstsConfig {
        private boolean enabled = true;
        private long maxAge = 31536000L; // 1ÎÖÑ
        private boolean includeSubDomains = true;
        private boolean preload = false;
    }
    
    @Data
    public static class FrameOptionsConfig {
        private String policy = "DENY"; // DENY, SAMEORIGIN, ALLOW-FROM
        private String allowFrom;
    }
}
```

### application.yml ÏÑ§Ï†ï
```yaml
app:
  security:
    headers:
      csp:
        enabled: true
        reporting-enabled: ${CSP_REPORTING_ENABLED:false}
        report-uri: "/api/v1/security/csp-report"
        script-sources:
          - "'self'"
          - "'unsafe-inline'"
          - "https://www.google.com/recaptcha/"
          - "https://www.gstatic.com/recaptcha/"
          - "https://apis.google.com"
        style-sources:
          - "'self'"
          - "'unsafe-inline'"
          - "https://fonts.googleapis.com"
        font-sources:
          - "'self'"
          - "https://fonts.gstatic.com"
        image-sources:
          - "'self'"
          - "data:"
          - "https:"
          - "blob:"
        connect-sources:
          - "'self'"
          - "https://api.routepick.co.kr"
      
      hsts:
        enabled: true
        max-age: 31536000  # 1ÎÖÑ
        include-sub-domains: true
        preload: false
      
      frame-options:
        policy: "DENY"
      
      custom-headers:
        "X-Application": "RoutePickr"
        "X-Version": "${app.version:1.0.0}"

---
# Í∞úÎ∞ú ÌôòÍ≤Ω ÏÑ§Ï†ï
spring:
  config:
    activate:
      on-profile: local, dev
      
app:
  security:
    headers:
      hsts:
        max-age: 86400  # 1Ïùº (Í∞úÎ∞ú ÌôòÍ≤Ω)
        preload: false
      csp:
        reporting-enabled: true

---
# ÌîÑÎ°úÎçïÏÖò ÌôòÍ≤Ω ÏÑ§Ï†ï
spring:
  config:
    activate:
      on-profile: prod
      
app:
  security:
    headers:
      hsts:
        max-age: 31536000  # 1ÎÖÑ
        preload: true
      csp:
        reporting-enabled: false
```

---

## üìä 3. CSP Î¶¨Ìè¨Ìä∏ ÏàòÏßë

### CspReportController.java
```java
package com.routepick.controller.security;

import com.routepick.service.security.CspViolationService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Map;

/**
 * CSP ÏúÑÎ∞ò Î¶¨Ìè¨Ìä∏ ÏàòÏßë API
 */
@Slf4j
@RestController
@RequestMapping("/api/v1/security")
@RequiredArgsConstructor
public class CspReportController {
    
    private final CspViolationService cspViolationService;
    
    /**
     * CSP ÏúÑÎ∞ò Î¶¨Ìè¨Ìä∏ ÏàòÏßë
     */
    @PostMapping("/csp-report")
    public ResponseEntity<Void> receiveCspReport(@RequestBody Map<String, Object> report) {
        try {
            // CSP ÏúÑÎ∞ò Î¶¨Ìè¨Ìä∏ Ï≤òÎ¶¨
            cspViolationService.processCspReport(report);
            
            log.debug("CSP violation report received: {}", report);
            return ResponseEntity.noContent().build();
            
        } catch (Exception e) {
            log.error("Failed to process CSP report", e);
            return ResponseEntity.badRequest().build();
        }
    }
}
```

### CspViolationService.java
```java
package com.routepick.service.security;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.Map;
import java.util.concurrent.TimeUnit;

/**
 * CSP ÏúÑÎ∞ò Ï≤òÎ¶¨ ÏÑúÎπÑÏä§
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class CspViolationService {
    
    private final RedisTemplate<String, Object> redisTemplate;
    private final SecurityAuditLogger auditLogger;
    
    private static final String CSP_VIOLATION_PREFIX = "security:csp:violation:";
    
    /**
     * CSP ÏúÑÎ∞ò Î¶¨Ìè¨Ìä∏ Ï≤òÎ¶¨
     */
    public void processCspReport(Map<String, Object> report) {
        try {
            // CSP Î¶¨Ìè¨Ìä∏ÏóêÏÑú Ï†ïÎ≥¥ Ï∂îÏ∂ú
            Map<String, Object> cspReport = (Map<String, Object>) report.get("csp-report");
            
            if (cspReport != null) {
                String documentUri = (String) cspReport.get("document-uri");
                String violatedDirective = (String) cspReport.get("violated-directive");
                String blockedUri = (String) cspReport.get("blocked-uri");
                String sourceFile = (String) cspReport.get("source-file");
                Integer lineNumber = (Integer) cspReport.get("line-number");
                
                // ÏúÑÎ∞ò Ï†ïÎ≥¥ Ï†ÄÏû•
                storeCspViolation(documentUri, violatedDirective, blockedUri, sourceFile, lineNumber);
                
                // Î≥¥Ïïà Ïù¥Î≤§Ìä∏ Î°úÍπÖ
                auditLogger.logSecurityViolation("CSP_VIOLATION",
                    String.format("CSP violation: %s blocked %s on %s", 
                        violatedDirective, blockedUri, documentUri),
                    "MEDIUM",
                    Map.of(
                        "documentUri", documentUri,
                        "violatedDirective", violatedDirective,
                        "blockedUri", blockedUri
                    ));
                
                log.info("CSP violation processed: directive={}, blockedUri={}", 
                        violatedDirective, blockedUri);
            }
            
        } catch (Exception e) {
            log.error("Failed to process CSP report", e);
        }
    }
    
    /**
     * CSP ÏúÑÎ∞ò Ï†ïÎ≥¥ Ï†ÄÏû•
     */
    private void storeCspViolation(String documentUri, String violatedDirective, 
                                  String blockedUri, String sourceFile, Integer lineNumber) {
        try {
            String key = CSP_VIOLATION_PREFIX + LocalDateTime.now().toLocalDate().toString();
            String value = String.format("%s|%s|%s|%s|%s|%d", 
                documentUri, violatedDirective, blockedUri, 
                sourceFile, lineNumber, System.currentTimeMillis());
            
            redisTemplate.opsForList().leftPush(key, value);
            redisTemplate.opsForList().trim(key, 0, 999); // ÏµúÎåÄ 1000Í∞ú
            redisTemplate.expire(key, 7, TimeUnit.DAYS);
            
        } catch (Exception e) {
            log.error("Failed to store CSP violation", e);
        }
    }
}
```

---

## üîç 4. Î≥¥Ïïà Ìó§Îçî Î™®ÎãàÌÑ∞ÎßÅ

### SecurityHeadersMonitoringService.java
```java
package com.routepick.service.security;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;

/**
 * Î≥¥Ïïà Ìó§Îçî Î™®ÎãàÌÑ∞ÎßÅ ÏÑúÎπÑÏä§
 * - Ìó§Îçî Ï§ÄÏàò ÏÉÅÌÉú Ï∂îÏ†Å
 * - CSP ÏúÑÎ∞ò Î∂ÑÏÑù
 * - Î≥¥Ïïà Ìó§Îçî ÌÜµÍ≥Ñ
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class SecurityHeadersMonitoringService {
    
    private final RedisTemplate<String, Object> redisTemplate;
    
    private static final String HEADERS_METRICS_PREFIX = "security:headers:metrics:";
    
    /**
     * Î≥¥Ïïà Ìó§Îçî ÌÜµÍ≥Ñ ÏàòÏßë
     */
    @Scheduled(fixedRate = 300000) // 5Î∂ÑÎßàÎã§
    public void collectHeadersStatistics() {
        try {
            Map<String, Object> stats = new HashMap<>();
            
            // CSP ÏúÑÎ∞ò ÌÜµÍ≥Ñ
            long cspViolations = getCspViolationCount();
            stats.put("cspViolations", cspViolations);
            
            // Ï†ÑÏ≤¥ ÏöîÏ≤≠ ÎåÄÎπÑ Î≥¥Ïïà Ìó§Îçî Ï†ÅÏö© ÎπÑÏú®
            stats.put("headersCoverage", calculateHeadersCoverage());
            
            // ÌôòÍ≤ΩÎ≥Ñ ÌÜµÍ≥Ñ
            stats.put("environment", getCurrentEnvironment());
            stats.put("timestamp", System.currentTimeMillis());
            
            // RedisÏóê ÌÜµÍ≥Ñ Ï†ÄÏû•
            String key = HEADERS_METRICS_PREFIX + LocalDateTime.now().toLocalDate().toString();
            redisTemplate.opsForHash().putAll(key, stats);
            redisTemplate.expire(key, 30, java.util.concurrent.TimeUnit.DAYS);
            
            log.debug("Security headers statistics collected: {}", stats);
            
        } catch (Exception e) {
            log.error("Failed to collect headers statistics", e);
        }
    }
    
    /**
     * CSP ÏúÑÎ∞ò Ïàò Ï°∞Ìöå
     */
    private long getCspViolationCount() {
        String pattern = "security:csp:violation:*";
        Set<String> keys = redisTemplate.keys(pattern);
        
        return keys.stream()
                .mapToLong(key -> {
                    Long size = redisTemplate.opsForList().size(key);
                    return size != null ? size : 0;
                })
                .sum();
    }
    
    /**
     * Ìó§Îçî Ï†ÅÏö© Î≤îÏúÑ Í≥ÑÏÇ∞
     */
    private double calculateHeadersCoverage() {
        // Ïã§Ï†ú Íµ¨ÌòÑÏóêÏÑúÎäî ÏöîÏ≤≠ ÏàòÏôÄ Ìó§Îçî Ï†ÅÏö© ÏàòÎ•º ÎπÑÍµê
        return 100.0; // Î™®Îì† ÏöîÏ≤≠Ïóê Ìó§Îçî Ï†ÅÏö©
    }
    
    /**
     * ÌòÑÏû¨ ÌôòÍ≤Ω Ï°∞Ìöå
     */
    private String getCurrentEnvironment() {
        return System.getProperty("spring.profiles.active", "default");
    }
    
    /**
     * Î≥¥Ïïà Ìó§Îçî Ï§ÄÏàò Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ±
     */
    public Map<String, Object> generateComplianceReport() {
        Map<String, Object> report = new HashMap<>();
        
        try {
            report.put("hstsEnabled", true);
            report.put("cspEnabled", true);
            report.put("frameOptionsEnabled", true);
            report.put("contentTypeOptionsEnabled", true);
            report.put("xssProtectionEnabled", true);
            
            report.put("totalViolations", getCspViolationCount());
            report.put("complianceScore", calculateComplianceScore());
            report.put("generatedAt", LocalDateTime.now());
            
        } catch (Exception e) {
            log.error("Failed to generate compliance report", e);
        }
        
        return report;
    }
    
    /**
     * Ïª¥ÌîåÎùºÏù¥Ïñ∏Ïä§ Ï†êÏàò Í≥ÑÏÇ∞
     */
    private double calculateComplianceScore() {
        // Î≥¥Ïïà Ìó§Îçî Ï†ÅÏö© ÏÉÅÌÉú Í∏∞Î∞ò Ï†êÏàò Í≥ÑÏÇ∞
        double score = 100.0;
        
        long violations = getCspViolationCount();
        if (violations > 100) score -= 10;
        if (violations > 500) score -= 20;
        if (violations > 1000) score -= 30;
        
        return Math.max(0, score);
    }
}
```

---

## üéõÔ∏è 5. Spring Security ÌÜµÌï©

### SecurityConfig.java ÏóÖÎç∞Ïù¥Ìä∏
```java
@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {
    
    private final SecurityHeadersFilter securityHeadersFilter;
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            // Î≥¥Ïïà Ìó§Îçî ÌïÑÌÑ∞ Ï∂îÍ∞Ä
            .addFilterBefore(securityHeadersFilter, UsernamePasswordAuthenticationFilter.class)
            
            // Spring Security Í∏∞Î≥∏ Ìó§Îçî ÏÑ§Ï†ï
            .headers(headers -> headers
                .frameOptions(frameOptions -> frameOptions.deny())
                .contentTypeOptions(contentTypeOptions -> contentTypeOptions.and())
                .httpStrictTransportSecurity(hstsConfig -> hstsConfig
                    .maxAgeInSeconds(31536000)
                    .includeSubdomains(true))
                .and()
            )
            
            // Í∏∞ÌÉÄ Î≥¥Ïïà ÏÑ§Ï†ï...
            ;
            
        return http.build();
    }
}
```

---

## üìà 6. Í¥ÄÎ¶¨Ïûê Î™®ÎãàÌÑ∞ÎßÅ API

### SecurityHeadersController.java
```java
package com.routepick.controller.admin;

import com.routepick.common.ApiResponse;
import com.routepick.service.security.SecurityHeadersMonitoringService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Map;

/**
 * Î≥¥Ïïà Ìó§Îçî Í¥ÄÎ¶¨ API (Í¥ÄÎ¶¨ÏûêÏö©)
 */
@RestController
@RequestMapping("/api/v1/admin/security/headers")
@RequiredArgsConstructor
@PreAuthorize("hasRole('ADMIN')")
public class SecurityHeadersController {
    
    private final SecurityHeadersMonitoringService monitoringService;
    
    /**
     * Î≥¥Ïïà Ìó§Îçî Ïª¥ÌîåÎùºÏù¥Ïñ∏Ïä§ Î¶¨Ìè¨Ìä∏
     */
    @GetMapping("/compliance")
    public ResponseEntity<ApiResponse<Map<String, Object>>> getComplianceReport() {
        Map<String, Object> report = monitoringService.generateComplianceReport();
        return ResponseEntity.ok(ApiResponse.success(report));
    }
}
```

---

## ‚úÖ Íµ¨ÌòÑ ÏôÑÎ£å Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏

- [x] Ï¢ÖÌï© Î≥¥Ïïà Ìó§Îçî ÌïÑÌÑ∞ Íµ¨ÌòÑ
- [x] Content Security Policy ÎèôÏ†Å ÏÑ§Ï†ï
- [x] HSTS ÌôòÍ≤ΩÎ≥Ñ ÏÑ§Ï†ï
- [x] CSP ÏúÑÎ∞ò Î¶¨Ìè¨Ìä∏ ÏàòÏßë
- [x] Î≥¥Ïïà Ìó§Îçî Î™®ÎãàÌÑ∞ÎßÅ ÏÑúÎπÑÏä§
- [x] Í¥ÄÎ¶¨Ïûê Ïª¥ÌîåÎùºÏù¥Ïñ∏Ïä§ Î¶¨Ìè¨Ìä∏
- [x] Spring Security ÌÜµÌï©
- [x] ÌôòÍ≤ΩÎ≥Ñ Ï∞®Î≥ÑÌôî ÏÑ§Ï†ï

---

*Step 8-3c ÏôÑÎ£å: Î≥¥Ïïà Ìó§Îçî ÏÑ§Ï†ï Íµ¨ÌòÑ*
*Îã§Ïùå ÌååÏùº: step8-3d_response_security.md*