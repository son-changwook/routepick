# Step 4-3c2: ÏÇ¨Ïö©Ïûê ÌôúÎèô ÏóîÌã∞Ìã∞ ÏÑ§Í≥Ñ

> **RoutePickr ÏÇ¨Ïö©Ïûê ÌôúÎèô ÏãúÏä§ÌÖú** - ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù, ÌåîÎ°úÏö∞ Í¥ÄÍ≥Ñ, ÏÜåÏÖú ÌôúÎèô  
> 
> **ÏÉùÏÑ±Ïùº**: 2025-08-20  
> **Îã®Í≥Ñ**: 4-3c2 (JPA ÏóîÌã∞Ìã∞ 50Í∞ú - ÏÇ¨Ïö©Ïûê ÌôúÎèô 2Í∞ú)  
> **Î∂ÑÌï†**: step4-3c_climbing_activity_entities.md ‚Üí ÏÇ¨Ïö©Ïûê ÌôúÎèô Î∂ÄÎ∂Ñ Ï∂îÏ∂ú

---

## üìã ÌååÏùº Í∞úÏöî

Ïù¥ ÌååÏùºÏùÄ **RoutePickrÏùò ÏÇ¨Ïö©Ïûê ÌôúÎèô ÏãúÏä§ÌÖú**ÏùÑ Îã¥Í≥† ÏûàÏäµÎãàÎã§.

### üéØ Ï£ºÏöî ÌäπÏßï
- **ÏÉÅÏÑ∏ ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù**: ÏÑ±Í≥µ/Ïã§Ìå®, ÏãúÎèÑ ÌöüÏàò, Î≤†ÌÉÄ Ï†ïÎ≥¥, Í∞úÏù∏ Í∏∞Î°ù
- **ÏÜåÏÖú ÌåîÎ°úÏö∞ ÏãúÏä§ÌÖú**: ÏÉÅÌò∏ ÌåîÎ°úÏö∞, ÌôúÏÑ±ÎèÑ Ï∂îÏ†Å, Í¥ÄÍ≥Ñ Í¥ÄÎ¶¨
- **ÏÑ±Í≥º Î∂ÑÏÑù**: ÏÑ±Í≥µÎ•†, ÎßåÏ°±ÎèÑ, Ïª®ÎîîÏÖò Ï†êÏàò, Í∞úÏù∏ Í∏∞Î°ù Ï∂îÏ†Å
- **Ïª§ÎÆ§ÎãàÌã∞ Ïó∞Îèô**: Í∏∞Î°ù Í≥µÏú†, ÌååÌä∏ÎÑà Ï†ïÎ≥¥, ÏÉÅÌò∏ÏûëÏö© Ï∂îÏ†Å

### üìä ÏóîÌã∞Ìã∞ Î™©Î°ù (2Í∞ú)
1. **UserClimb** - ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù (ÏÉÅÏÑ∏ ÎèÑÏ†Ñ Í∏∞Î°ù, ÏÑ±Í≥º Î∂ÑÏÑù)
2. **UserFollow** - ÌåîÎ°úÏö∞ Í¥ÄÍ≥Ñ (ÏÉÅÌò∏ ÌåîÎ°úÏö∞, ÌôúÏÑ±ÎèÑ Ï∂îÏ†Å)

---

## üìà 1. UserClimb ÏóîÌã∞Ìã∞ - ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù

```java
package com.routepick.domain.activity.entity;

import com.routepick.common.entity.BaseEntity;
import com.routepick.domain.route.entity.Route;
import com.routepick.domain.user.entity.User;
import jakarta.persistence.*;
import jakarta.validation.constraints.Max;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotNull;
import jakarta.validation.constraints.Size;
import lombok.*;

import java.time.LocalDate;
import java.time.LocalTime;

/**
 * ÏÇ¨Ïö©Ïûê ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù
 * - Í∞úÎ≥Ñ Î£®Ìä∏ ÎèÑÏ†Ñ Í∏∞Î°ù
 * - ÏÑ±Í≥µ/Ïã§Ìå®, ÏãúÎèÑ ÌöüÏàò, ÏÜåÏöî ÏãúÍ∞Ñ Îì±
 */
@Entity
@Table(name = "user_climbs", indexes = {
    @Index(name = "idx_climb_user_date", columnList = "user_id, climb_date DESC"),
    @Index(name = "idx_climb_route", columnList = "route_id"),
    @Index(name = "idx_climb_user_route", columnList = "user_id, route_id"),
    @Index(name = "idx_climb_success", columnList = "is_successful, climb_date DESC"),
    @Index(name = "idx_climb_rating", columnList = "difficulty_rating DESC"),
    @Index(name = "idx_climb_branch", columnList = "branch_id, climb_date DESC")
})
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor(access = AccessLevel.PRIVATE)
@Builder
public class UserClimb extends BaseEntity {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "climb_id")
    private Long climbId;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User user;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "route_id", nullable = false)
    private Route route;
    
    // ===== ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î≥∏ Ï†ïÎ≥¥ =====
    
    @NotNull
    @Column(name = "climb_date", nullable = false)
    private LocalDate climbDate; // ÌÅ¥ÎùºÏù¥Î∞ç ÎÇ†Ïßú
    
    @Column(name = "start_time")
    private LocalTime startTime; // ÏãúÏûë ÏãúÍ∞Ñ
    
    @Column(name = "end_time")
    private LocalTime endTime; // Ï¢ÖÎ£å ÏãúÍ∞Ñ
    
    @Column(name = "is_successful", nullable = false)
    private boolean isSuccessful = false; // ÏÑ±Í≥µ Ïó¨Î∂Ä
    
    @Min(value = 1, message = "ÏãúÎèÑ ÌöüÏàòÎäî 1Ìöå Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§")
    @Column(name = "attempt_count", nullable = false)
    private Integer attemptCount = 1; // ÏãúÎèÑ ÌöüÏàò
    
    @Column(name = "success_attempt")
    private Integer successAttempt; // ÏÑ±Í≥µÌïú ÏãúÎèÑ Î≤àÌò∏
    
    // ===== ÏÑ±Í≥º Ï†ïÎ≥¥ =====
    
    @Column(name = "climb_type", length = 30)
    private String climbType; // FLASH, ONSIGHT, REDPOINT, REPEAT
    
    @Min(value = 1)
    @Max(value = 5)
    @Column(name = "difficulty_rating")
    private Integer difficultyRating; // Ï≤¥Í∞ê ÎÇúÏù¥ÎèÑ ÌèâÏ†ê (1-5)
    
    @Min(value = 1)
    @Max(value = 5)
    @Column(name = "enjoyment_rating")
    private Integer enjoymentRating; // Ïû¨ÎØ∏ ÌèâÏ†ê (1-5)
    
    @Min(value = 1)
    @Max(value = 5)
    @Column(name = "quality_rating")
    private Integer qualityRating; // Î£®Ìä∏ ÌíàÏßà ÌèâÏ†ê (1-5)
    
    @Column(name = "personal_record", nullable = false)
    private boolean personalRecord = false; // Í∞úÏù∏ Í∏∞Î°ù Ïó¨Î∂Ä
    
    // ===== ÏÉÅÏÑ∏ Í∏∞Î°ù =====
    
    @Column(name = "total_time_minutes")
    private Integer totalTimeMinutes; // Ï¥ù ÏÜåÏöî ÏãúÍ∞Ñ (Î∂Ñ)
    
    @Column(name = "rest_time_minutes")
    private Integer restTimeMinutes; // Ìú¥Ïãù ÏãúÍ∞Ñ (Î∂Ñ)
    
    @Column(name = "fall_count")
    private Integer fallCount = 0; // Ï∂îÎùΩ ÌöüÏàò
    
    @Column(name = "key_holds_missed")
    private String keyHoldsMissed; // ÎÜìÏπú ÌïµÏã¨ ÌôÄÎìú
    
    @Column(name = "beta_used", columnDefinition = "TEXT")
    private String betaUsed; // ÏÇ¨Ïö©Ìïú Î≤†ÌÉÄ
    
    @Column(name = "technique_notes", columnDefinition = "TEXT")
    private String techniqueNotes; // Í∏∞Ïà† Î©îÎ™®
    
    // ===== ÌôòÍ≤Ω Ï†ïÎ≥¥ =====
    
    @Column(name = "branch_id")
    private Long branchId; // ÏïîÏû• ÏßÄÏ†ê ID (ÎπÑÏ†ïÍ∑úÌôî)
    
    @Column(name = "wall_condition", length = 50)
    private String wallCondition; // Î≤ΩÎ©¥ ÏÉÅÌÉú
    
    @Column(name = "weather_condition", length = 50)
    private String weatherCondition; // ÎÇ†Ïî® (Ïã§Ïô∏Ïù∏ Í≤ΩÏö∞)
    
    @Column(name = "crowd_level", length = 20)
    private String crowdLevel; // ÌòºÏû°ÎèÑ (EMPTY, LOW, MODERATE, HIGH, CROWDED)
    
    // ===== Ïã†Ï≤¥/Ïû•ÎπÑ Ï†ïÎ≥¥ =====
    
    @Column(name = "climbing_shoe_id")
    private Long climbingShoeId; // ÏÇ¨Ïö©Ìïú Ïã†Î∞ú ID
    
    @Column(name = "chalk_type", length = 30)
    private String chalkType; // ÏÇ¨Ïö©Ìïú Ï¥àÌÅ¨ Ï¢ÖÎ•ò
    
    @Column(name = "physical_condition", length = 30)
    private String physicalCondition; // Ïª®ÎîîÏÖò (EXCELLENT, GOOD, FAIR, POOR)
    
    @Column(name = "injury_notes", length = 200)
    private String injuryNotes; // Î∂ÄÏÉÅ Î©îÎ™®
    
    // ===== ÏÜåÏÖú/Í≥µÏú† Ï†ïÎ≥¥ =====
    
    @Column(name = "climb_notes", columnDefinition = "TEXT")
    private String climbNotes; // ÌÅ¥ÎùºÏù¥Î∞ç Î©îÎ™®
    
    @Column(name = "is_public", nullable = false)
    private boolean isPublic = true; // Í≥µÍ∞ú Ïó¨Î∂Ä
    
    @Column(name = "shared_with_community", nullable = false)
    private boolean sharedWithCommunity = false; // Ïª§ÎÆ§ÎãàÌã∞ Í≥µÏú† Ïó¨Î∂Ä
    
    @Column(name = "climb_partners", length = 200)
    private String climbPartners; // Ìï®ÍªòÌïú ÌååÌä∏ÎÑàÎì§
    
    @Column(name = "witness_count")
    private Integer witnessCount = 0; // Î™©Í≤©Ïûê Ïàò
    
    // ===== Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ =====
    
    @Column(name = "gps_latitude", precision = 10, scale = 8)
    private java.math.BigDecimal gpsLatitude; // GPS ÏúÑÎèÑ
    
    @Column(name = "gps_longitude", precision = 11, scale = 8)
    private java.math.BigDecimal gpsLongitude; // GPS Í≤ΩÎèÑ
    
    @Column(name = "recorded_device", length = 50)
    private String recordedDevice; // Í∏∞Î°ù ÎîîÎ∞îÏù¥Ïä§
    
    @Column(name = "session_id", length = 100)
    private String sessionId; // ÏÑ∏ÏÖò ID (Í∞ôÏùÄ ÎÇ† Í∞ôÏùÄ Ïû•ÏÜå)
    
    // ===== ÎπÑÏ¶àÎãàÏä§ Î©îÏÑúÎìú =====
    
    /**
     * ÌÅ¥ÎùºÏù¥Î∞ç ÌÉÄÏûÖ ÌïúÍ∏Ä ÌëúÏãú
     */
    @Transient
    public String getClimbTypeKorean() {
        if (climbType == null) return "ÏùºÎ∞ò";
        
        return switch (climbType) {
            case "FLASH" -> "ÌîåÎûòÏãú";
            case "ONSIGHT" -> "Ïò®ÏÇ¨Ïù¥Ìä∏";
            case "REDPOINT" -> "Î†àÎìúÌè¨Ïù∏Ìä∏";
            case "REPEAT" -> "Î∞òÎ≥µ ÏôÑÎì±";
            default -> "ÏùºÎ∞ò";
        };
    }
    
    /**
     * ÏÑ±Í≥µÎ•† Í≥ÑÏÇ∞
     */
    @Transient
    public float getSuccessRate() {
        if (attemptCount == null || attemptCount == 0) return 0.0f;
        return isSuccessful ? (1.0f / attemptCount * 100) : 0.0f;
    }
    
    /**
     * ÏàúÏàò ÌÅ¥ÎùºÏù¥Î∞ç ÏãúÍ∞Ñ Í≥ÑÏÇ∞
     */
    @Transient
    public Integer getActiveClimbTime() {
        if (totalTimeMinutes == null) return null;
        if (restTimeMinutes == null) return totalTimeMinutes;
        
        return Math.max(0, totalTimeMinutes - restTimeMinutes);
    }
    
    /**
     * Ïª®ÎîîÏÖò Ï†êÏàò Í≥ÑÏÇ∞ (1-100)
     */
    @Transient
    public int getConditionScore() {
        if (physicalCondition == null) return 50;
        
        return switch (physicalCondition) {
            case "EXCELLENT" -> 90;
            case "GOOD" -> 70;
            case "FAIR" -> 50;
            case "POOR" -> 30;
            default -> 50;
        };
    }
    
    /**
     * Ï†ÑÏ≤¥ ÎßåÏ°±ÎèÑ Í≥ÑÏÇ∞
     */
    @Transient
    public float getOverallSatisfaction() {
        int total = 0;
        int count = 0;
        
        if (difficultyRating != null) { total += difficultyRating; count++; }
        if (enjoymentRating != null) { total += enjoymentRating; count++; }
        if (qualityRating != null) { total += qualityRating; count++; }
        
        return count > 0 ? (float) total / count : 0.0f;
    }
    
    /**
     * ÌòºÏû°ÎèÑ ÌïúÍ∏Ä ÌëúÏãú
     */
    @Transient
    public String getCrowdLevelKorean() {
        if (crowdLevel == null) return "Î≥¥ÌÜµ";
        
        return switch (crowdLevel) {
            case "EMPTY" -> "ÌïúÏÇ∞Ìï®";
            case "LOW" -> "Ïó¨Ïú†Î°úÏõÄ";
            case "MODERATE" -> "Î≥¥ÌÜµ";
            case "HIGH" -> "Î∂êÎπî";
            case "CROWDED" -> "Îß§Ïö∞ Î∂êÎπî";
            default -> "Î≥¥ÌÜµ";
        };
    }
    
    /**
     * Ïª®ÎîîÏÖò ÌïúÍ∏Ä ÌëúÏãú
     */
    @Transient
    public String getPhysicalConditionKorean() {
        if (physicalCondition == null) return "Î≥¥ÌÜµ";
        
        return switch (physicalCondition) {
            case "EXCELLENT" -> "ÏµúÏÉÅ";
            case "GOOD" -> "Ï¢ãÏùå";
            case "FAIR" -> "Î≥¥ÌÜµ";
            case "POOR" -> "ÎÇòÏÅ®";
            default -> "Î≥¥ÌÜµ";
        };
    }
    
    /**
     * ÏÑ±Í≥µ Í∏∞Î°ù Ï≤òÎ¶¨
     */
    public void recordSuccess(int attemptNumber, String beta, String notes) {
        this.isSuccessful = true;
        this.successAttempt = attemptNumber;
        this.betaUsed = beta;
        this.techniqueNotes = notes;
        this.personalRecord = checkPersonalRecord();
    }
    
    /**
     * Í∞úÏù∏ Í∏∞Î°ù ÌôïÏù∏ (Service LayerÏóêÏÑú Íµ¨ÌòÑ ÏòàÏ†ï)
     */
    private boolean checkPersonalRecord() {
        // Service LayerÏóêÏÑú Íµ¨ÌòÑ
        // Ìï¥Îãπ ÏÇ¨Ïö©ÏûêÏùò Ïù¥Ï†Ñ Í∏∞Î°ùÍ≥º ÎπÑÍµê
        return false;
    }
    
    /**
     * ÏãúÍ∞Ñ Í∏∞Î°ù ÏÑ§Ï†ï
     */
    public void setTimeRecord(LocalTime start, LocalTime end, Integer restMinutes) {
        this.startTime = start;
        this.endTime = end;
        this.restTimeMinutes = restMinutes;
        
        if (start != null && end != null) {
            long totalMinutes = java.time.Duration.between(start, end).toMinutes();
            this.totalTimeMinutes = (int) totalMinutes;
        }
    }
    
    /**
     * ÌèâÏ†ê ÏóÖÎç∞Ïù¥Ìä∏
     */
    public void updateRatings(Integer difficulty, Integer enjoyment, Integer quality) {
        this.difficultyRating = difficulty;
        this.enjoymentRating = enjoyment;
        this.qualityRating = quality;
    }
    
    /**
     * Ïª§ÎÆ§ÎãàÌã∞ Í≥µÏú†
     */
    public void shareWithCommunity(String partners, String notes) {
        this.sharedWithCommunity = true;
        this.climbPartners = partners;
        this.climbNotes = notes;
        this.isPublic = true;
    }
    
    /**
     * ÌôòÍ≤Ω Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
     */
    public void updateEnvironment(String wallCondition, String weatherCondition, String crowdLevel) {
        this.wallCondition = wallCondition;
        this.weatherCondition = weatherCondition;
        this.crowdLevel = crowdLevel;
    }
    
    /**
     * Ïû•ÎπÑ Ï†ïÎ≥¥ ÏÑ§Ï†ï
     */
    public void setGearInfo(Long shoeId, String chalkType) {
        this.climbingShoeId = shoeId;
        this.chalkType = chalkType;
    }
    
    /**
     * Ï∂îÎùΩ Í∏∞Î°ù
     */
    public void recordFall() {
        this.fallCount = (fallCount == null ? 0 : fallCount) + 1;
    }
    
    /**
     * Î™©Í≤©Ïûê Ï∂îÍ∞Ä
     */
    public void addWitness() {
        this.witnessCount = (witnessCount == null ? 0 : witnessCount) + 1;
    }
    
    /**
     * GPS ÏúÑÏπò ÏÑ§Ï†ï
     */
    public void setGpsLocation(java.math.BigDecimal latitude, java.math.BigDecimal longitude) {
        this.gpsLatitude = latitude;
        this.gpsLongitude = longitude;
    }
    
    @Override
    public Long getId() {
        return climbId;
    }
}
```

---

## üë• 2. UserFollow ÏóîÌã∞Ìã∞ - ÌåîÎ°úÏö∞ Í¥ÄÍ≥Ñ

```java
package com.routepick.domain.activity.entity;

import com.routepick.common.entity.BaseEntity;
import com.routepick.domain.user.entity.User;
import jakarta.persistence.*;
import jakarta.validation.constraints.NotNull;
import lombok.*;

import java.time.LocalDateTime;

/**
 * ÏÇ¨Ïö©Ïûê ÌåîÎ°úÏö∞ Í¥ÄÍ≥Ñ
 * - ÌåîÎ°úÏõå/ÌåîÎ°úÏûâ Í¥ÄÍ≥Ñ Í¥ÄÎ¶¨
 * - ÏÉÅÌò∏ ÌåîÎ°úÏö∞ ÌôïÏù∏
 */
@Entity
@Table(name = "user_follows", indexes = {
    @Index(name = "idx_follow_relationship", columnList = "follower_user_id, following_user_id", unique = true),
    @Index(name = "idx_follow_follower", columnList = "follower_user_id"),
    @Index(name = "idx_follow_following", columnList = "following_user_id"),
    @Index(name = "idx_follow_mutual", columnList = "is_mutual"),
    @Index(name = "idx_follow_date", columnList = "follow_date DESC"),
    @Index(name = "idx_follow_active", columnList = "is_active")
})
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor(access = AccessLevel.PRIVATE)
@Builder
public class UserFollow extends BaseEntity {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "follow_id")
    private Long followId;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "follower_user_id", nullable = false)
    private User followerUser; // ÌåîÎ°úÏö∞ ÌïòÎäî ÏÇ¨Ïö©Ïûê
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "following_user_id", nullable = false)
    private User followingUser; // ÌåîÎ°úÏö∞ Î∞õÎäî ÏÇ¨Ïö©Ïûê
    
    @NotNull
    @Column(name = "follow_date", nullable = false)
    private LocalDateTime followDate; // ÌåîÎ°úÏö∞ ÏãúÏûëÏùº
    
    @Column(name = "unfollow_date")
    private LocalDateTime unfollowDate; // Ïñ∏ÌåîÎ°úÏö∞ ÏùºÏãú
    
    @Column(name = "is_mutual", nullable = false)
    private boolean isMutual = false; // ÏÉÅÌò∏ ÌåîÎ°úÏö∞ Ïó¨Î∂Ä
    
    @Column(name = "is_active", nullable = false)
    private boolean isActive = true; // ÌôúÏÑ± ÌåîÎ°úÏö∞
    
    @Column(name = "follow_source", length = 50)
    private String followSource; // ÌåîÎ°úÏö∞ Í≤ΩÎ°ú (SEARCH, RECOMMENDATION, ROUTE, COMMENT Îì±)
    
    @Column(name = "notification_enabled", nullable = false)
    private boolean notificationEnabled = true; // ÏïåÎ¶º ÏÑ§Ï†ï
    
    @Column(name = "close_friend", nullable = false)
    private boolean closeFriend = false; // ÏπúÌïú ÏπúÍµ¨ ÌëúÏãú
    
    @Column(name = "blocked", nullable = false)
    private boolean blocked = false; // Ï∞®Îã® Ïó¨Î∂Ä
    
    @Column(name = "muted", nullable = false)
    private boolean muted = false; // ÏùåÏÜåÍ±∞ Ïó¨Î∂Ä
    
    // ===== ÌÜµÍ≥Ñ Ï†ïÎ≥¥ =====
    
    @Column(name = "interaction_count")
    private Integer interactionCount = 0; // ÏÉÅÌò∏ÏûëÏö© ÌöüÏàò
    
    @Column(name = "last_interaction_date")
    private LocalDateTime lastInteractionDate; // ÎßàÏßÄÎßâ ÏÉÅÌò∏ÏûëÏö© ÏùºÏãú
    
    @Column(name = "mutual_climb_count")
    private Integer mutualClimbCount = 0; // Ìï®ÍªòÌïú ÌÅ¥ÎùºÏù¥Î∞ç Ïàò
    
    @Column(name = "last_activity_view_date")
    private LocalDateTime lastActivityViewDate; // ÎßàÏßÄÎßâ ÌôúÎèô Ï°∞ÌöåÏùº
    
    // ===== Í∞úÏù∏Ï†ïÎ≥¥ =====
    
    @Column(name = "follow_note", length = 200)
    private String followNote; // ÌåîÎ°úÏö∞ Î©îÎ™®
    
    @Column(name = "nickname", length = 50)
    private String nickname; // Í∞úÏù∏Ï†Å Î≥ÑÎ™Ö
    
    @Column(name = "relationship_type", length = 30)
    private String relationshipType; // FRIEND, CLIMBING_PARTNER, INSPIRATION, OTHER
    
    // ===== ÎπÑÏ¶àÎãàÏä§ Î©îÏÑúÎìú =====
    
    /**
     * ÌåîÎ°úÏö∞ Í¥ÄÍ≥Ñ ÌïúÍ∏Ä ÌëúÏãú
     */
    @Transient
    public String getRelationshipTypeKorean() {
        if (relationshipType == null) return "ÏùºÎ∞ò";
        
        return switch (relationshipType) {
            case "FRIEND" -> "ÏπúÍµ¨";
            case "CLIMBING_PARTNER" -> "ÌÅ¥ÎùºÏù¥Î∞ç ÌååÌä∏ÎÑà";
            case "INSPIRATION" -> "ÏòÅÍ∞êÏùÑ Ï£ºÎäî ÏÇ¨Îûå";
            case "OTHER" -> "Í∏∞ÌÉÄ";
            default -> "ÏùºÎ∞ò";
        };
    }
    
    /**
     * ÌåîÎ°úÏö∞ ÏÜåÏä§ ÌïúÍ∏Ä ÌëúÏãú
     */
    @Transient
    public String getFollowSourceKorean() {
        if (followSource == null) return "ÏùºÎ∞ò";
        
        return switch (followSource) {
            case "SEARCH" -> "Í≤ÄÏÉâ";
            case "RECOMMENDATION" -> "Ï∂îÏ≤ú";
            case "ROUTE" -> "Î£®Ìä∏ ÌéòÏù¥ÏßÄ";
            case "COMMENT" -> "ÎåìÍ∏Ä";
            case "COMMUNITY" -> "Ïª§ÎÆ§ÎãàÌã∞";
            case "FRIEND_SUGGESTION" -> "ÏπúÍµ¨ Ï∂îÏ≤ú";
            default -> "ÏùºÎ∞ò";
        };
    }
    
    /**
     * ÌåîÎ°úÏö∞ Í∏∞Í∞Ñ Í≥ÑÏÇ∞ (Ïùº)
     */
    @Transient
    public long getFollowDurationDays() {
        if (followDate == null) return 0;
        
        LocalDateTime endDate = isActive ? LocalDateTime.now() : unfollowDate;
        if (endDate == null) endDate = LocalDateTime.now();
        
        return java.time.temporal.ChronoUnit.DAYS.between(followDate, endDate);
    }
    
    /**
     * ÌôúÏÑ±ÎèÑ Ï†êÏàò Í≥ÑÏÇ∞ (0-100)
     */
    @Transient
    public int getActivityScore() {
        int score = 0;
        
        // Í∏∞Î≥∏ ÌåîÎ°úÏö∞ Ï†êÏàò
        score += 20;
        
        // ÏÉÅÌò∏ ÌåîÎ°úÏö∞ Î≥¥ÎÑàÏä§
        if (isMutual) score += 30;
        
        // ÏÉÅÌò∏ÏûëÏö© Ï†êÏàò
        if (interactionCount != null) {
            score += Math.min(interactionCount * 2, 30);
        }
        
        // ÏµúÍ∑º ÌôúÎèô Î≥¥ÎÑàÏä§
        if (lastInteractionDate != null) {
            long daysSinceLastInteraction = java.time.temporal.ChronoUnit.DAYS
                .between(lastInteractionDate, LocalDateTime.now());
            
            if (daysSinceLastInteraction <= 7) score += 20;
            else if (daysSinceLastInteraction <= 30) score += 10;
        }
        
        return Math.min(score, 100);
    }
    
    /**
     * ÏπúÎ∞ÄÎèÑ Î†àÎ≤® Í≥ÑÏÇ∞
     */
    @Transient
    public String getIntimacyLevel() {
        int activityScore = getActivityScore();
        
        if (closeFriend) return "ÏπúÌïú ÏπúÍµ¨";
        if (activityScore >= 80) return "Îß§Ïö∞ ÏπúÌï®";
        if (activityScore >= 60) return "ÏπúÌï®";
        if (activityScore >= 40) return "Î≥¥ÌÜµ";
        if (activityScore >= 20) return "ÏïåÍ≥† ÏßÄÎÉÑ";
        return "ÏÉàÎ°úÏö¥ ÌåîÎ°úÏö∞";
    }
    
    /**
     * ÏÉÅÌò∏ÏûëÏö© Í∏∞Î°ù
     */
    public void recordInteraction() {
        this.interactionCount = (interactionCount == null ? 0 : interactionCount) + 1;
        this.lastInteractionDate = LocalDateTime.now();
    }
    
    /**
     * ÏÉÅÌò∏ ÌåîÎ°úÏö∞ ÏÑ§Ï†ï
     */
    public void setMutualFollow() {
        this.isMutual = true;
    }
    
    /**
     * ÏÉÅÌò∏ ÌåîÎ°úÏö∞ Ìï¥Ï†ú
     */
    public void unsetMutualFollow() {
        this.isMutual = false;
    }
    
    /**
     * Ïñ∏ÌåîÎ°úÏö∞ Ï≤òÎ¶¨
     */
    public void unfollow() {
        this.isActive = false;
        this.unfollowDate = LocalDateTime.now();
        this.isMutual = false;
        this.notificationEnabled = false;
    }
    
    /**
     * ÌåîÎ°úÏö∞ Ïû¨Í∞ú
     */
    public void refollow() {
        this.isActive = true;
        this.unfollowDate = null;
        this.followDate = LocalDateTime.now(); // ÏÉàÎ°úÏö¥ ÌåîÎ°úÏö∞ ÎÇ†Ïßú
        this.notificationEnabled = true;
    }
    
    /**
     * Ï∞®Îã® Ï≤òÎ¶¨
     */
    public void block() {
        this.blocked = true;
        this.isActive = false;
        this.notificationEnabled = false;
        this.isMutual = false;
    }
    
    /**
     * Ï∞®Îã® Ìï¥Ï†ú
     */
    public void unblock() {
        this.blocked = false;
    }
    
    /**
     * ÏùåÏÜåÍ±∞ Ï≤òÎ¶¨
     */
    public void mute() {
        this.muted = true;
        this.notificationEnabled = false;
    }
    
    /**
     * ÏùåÏÜåÍ±∞ Ìï¥Ï†ú
     */
    public void unmute() {
        this.muted = false;
        this.notificationEnabled = true;
    }
    
    /**
     * ÏπúÌïú ÏπúÍµ¨ ÏÑ§Ï†ï
     */
    public void setCloseFriend(boolean isCloseFriend) {
        this.closeFriend = isCloseFriend;
    }
    
    /**
     * Í∞úÏù∏ Î©îÎ™® ÏóÖÎç∞Ïù¥Ìä∏
     */
    public void updateNote(String note, String nickname, String relationshipType) {
        this.followNote = note;
        this.nickname = nickname;
        this.relationshipType = relationshipType;
    }
    
    /**
     * Ìï®ÍªòÌïú ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù
     */
    public void recordMutualClimb() {
        this.mutualClimbCount = (mutualClimbCount == null ? 0 : mutualClimbCount) + 1;
        recordInteraction();
    }
    
    /**
     * ÎßàÏßÄÎßâ ÌôúÎèô Ï°∞Ìöå ÏóÖÎç∞Ïù¥Ìä∏
     */
    public void updateLastActivityView() {
        this.lastActivityViewDate = LocalDateTime.now();
    }
    
    /**
     * ÌåîÎ°úÏö∞ Í¥ÄÍ≥Ñ Í∞ïÎèÑ Í≥ÑÏÇ∞ (0.0-1.0)
     */
    @Transient
    public float getRelationshipStrength() {
        float strength = 0.0f;
        
        // Í∏∞Î≥∏ ÌåîÎ°úÏö∞ Ï†êÏàò
        strength += 0.2f;
        
        // ÏÉÅÌò∏ ÌåîÎ°úÏö∞
        if (isMutual) strength += 0.3f;
        
        // ÏÉÅÌò∏ÏûëÏö© ÎπàÎèÑ
        if (interactionCount != null && interactionCount > 0) {
            strength += Math.min(interactionCount * 0.01f, 0.3f);
        }
        
        // ÏµúÍ∑º ÌôúÎèô
        if (lastInteractionDate != null) {
            long daysSinceLastInteraction = java.time.temporal.ChronoUnit.DAYS
                .between(lastInteractionDate, LocalDateTime.now());
                
            if (daysSinceLastInteraction <= 7) strength += 0.2f;
            else if (daysSinceLastInteraction <= 30) strength += 0.1f;
        }
        
        // ÏπúÌïú ÏπúÍµ¨ Î≥¥ÎÑàÏä§
        if (closeFriend) strength += 0.1f;
        
        // Ìï®ÍªòÌïú ÌÅ¥ÎùºÏù¥Î∞ç
        if (mutualClimbCount != null && mutualClimbCount > 0) {
            strength += Math.min(mutualClimbCount * 0.02f, 0.1f);
        }
        
        return Math.min(strength, 1.0f);
    }
    
    /**
     * ÏïåÎ¶º ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏
     */
    public void updateNotificationSettings(boolean enabled) {
        if (!blocked && !muted) {
            this.notificationEnabled = enabled;
        }
    }
    
    @Override
    public Long getId() {
        return followId;
    }
}
```

---

## ‚ö° 3. ÏÑ±Îä• ÏµúÏ†ÅÌôî Ï†ÑÎûµ

### Î≥µÌï© Ïù∏Îç±Ïä§ DDL Ï∂îÍ∞Ä
```sql
-- ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù Î∂ÑÏÑùÏö© Ïù∏Îç±Ïä§
CREATE INDEX idx_climb_user_success_date 
ON user_climbs(user_id, is_successful, climb_date DESC);

-- Î£®Ìä∏Î≥Ñ ÏÑ±Í≥µÎ•† Í≥ÑÏÇ∞Ïö©
CREATE INDEX idx_climb_route_success 
ON user_climbs(route_id, is_successful, attempt_count);

-- ÏÇ¨Ïö©ÏûêÎ≥Ñ Í∞úÏù∏ Í∏∞Î°ù Í≤ÄÏÉâ
CREATE INDEX idx_climb_personal_record 
ON user_climbs(user_id, personal_record, climb_date DESC);

-- ÌåîÎ°úÏö∞ Ï∂îÏ≤úÏö© Ïù∏Îç±Ïä§
CREATE INDEX idx_follow_mutual_activity 
ON user_follows(is_mutual, is_active, last_interaction_date DESC);

-- ÌôúÏÑ± ÌåîÎ°úÏö∞ Í¥ÄÍ≥Ñ Ï°∞Ìöå
CREATE INDEX idx_follow_active_mutual 
ON user_follows(follower_user_id, is_active, is_mutual);

-- ÌåîÎ°úÏö∞ ÏÜåÏä§Î≥Ñ ÌÜµÍ≥ÑÏö©
CREATE INDEX idx_follow_source_stats 
ON user_follows(follow_source, is_active, follow_date DESC);
```

### ÌÜµÍ≥Ñ Ï†ïÎ≥¥ Í≥ÑÏÇ∞ ÏøºÎ¶¨ ÏòàÏãú
```java
// RepositoryÏóêÏÑú ÏÇ¨Ïö©Ìï† ÌÜµÍ≥Ñ ÏøºÎ¶¨Îì§

// ÏÇ¨Ïö©ÏûêÎ≥Ñ ÏÑ±Í≥µÎ•† Í≥ÑÏÇ∞
@Query("SELECT COUNT(CASE WHEN uc.isSuccessful = true THEN 1 END) * 100.0 / COUNT(*) " +
       "FROM UserClimb uc WHERE uc.user.id = :userId")
Double getUserSuccessRate(@Param("userId") Long userId);

// Î£®Ìä∏Î≥Ñ ÌèâÍ∑† ÏãúÎèÑ ÌöüÏàò
@Query("SELECT AVG(uc.attemptCount) FROM UserClimb uc " +
       "WHERE uc.route.id = :routeId AND uc.isSuccessful = true")
Double getAverageAttempts(@Param("routeId") Long routeId);

// ÏÉÅÌò∏ ÌåîÎ°úÏö∞ Î™©Î°ù
@Query("SELECT uf.followingUser FROM UserFollow uf " +
       "WHERE uf.followerUser.id = :userId " +
       "AND uf.isActive = true AND uf.isMutual = true " +
       "ORDER BY uf.lastInteractionDate DESC")
List<User> findMutualFollows(@Param("userId") Long userId);

// ÏÇ¨Ïö©ÏûêÎ≥Ñ ÏõîÍ∞Ñ ÌÅ¥ÎùºÏù¥Î∞ç ÌÜµÍ≥Ñ
@Query("SELECT COUNT(*), AVG(uc.attemptCount), " +
       "COUNT(CASE WHEN uc.isSuccessful = true THEN 1 END) " +
       "FROM UserClimb uc " +
       "WHERE uc.user.id = :userId " +
       "AND uc.climbDate >= :startDate AND uc.climbDate <= :endDate")
Object[] getMonthlyClimbStats(@Param("userId") Long userId, 
                             @Param("startDate") LocalDate startDate,
                             @Param("endDate") LocalDate endDate);

// ÌåîÎ°úÏö∞ ÌôúÏÑ±ÎèÑ Í∏∞Î∞ò Ï∂îÏ≤ú
@Query("SELECT uf FROM UserFollow uf " +
       "WHERE uf.followerUser.id IN (" +
       "  SELECT uf2.followingUser.id FROM UserFollow uf2 " +
       "  WHERE uf2.followerUser.id = :userId AND uf2.isActive = true" +
       ") " +
       "AND uf.followingUser.id != :userId " +
       "AND uf.isActive = true " +
       "GROUP BY uf.followingUser " +
       "ORDER BY COUNT(uf) DESC, MAX(uf.lastInteractionDate) DESC")
List<UserFollow> findFollowRecommendations(@Param("userId") Long userId);
```

### Ï∫êÏãú Ï†ÑÎûµ
```java
// Redis Ï∫êÏãúÎ•º ÌôúÏö©Ìïú ÌÜµÍ≥Ñ Ï†ïÎ≥¥ Í¥ÄÎ¶¨

@Cacheable(value = "userClimbStats", key = "#userId")
public UserClimbStatistics getUserClimbStatistics(Long userId) {
    return UserClimbStatistics.builder()
        .userId(userId)
        .totalClimbs(climbRepository.countByUserId(userId))
        .successfulClimbs(climbRepository.countByUserIdAndIsSuccessful(userId, true))
        .averageAttempts(climbRepository.getAverageAttempts(userId))
        .personalRecords(climbRepository.countByUserIdAndPersonalRecord(userId, true))
        .build();
}

@Cacheable(value = "userFollowStats", key = "#userId")
public UserFollowStatistics getUserFollowStatistics(Long userId) {
    return UserFollowStatistics.builder()
        .userId(userId)
        .followersCount(followRepository.countByFollowingUserIdAndIsActive(userId, true))
        .followingCount(followRepository.countByFollowerUserIdAndIsActive(userId, true))
        .mutualFollowsCount(followRepository.countByFollowerUserIdAndIsActiveAndIsMutual(userId, true, true))
        .build();
}

// Î∞∞Ïπò ÏûëÏóÖÏúºÎ°ú ÌÜµÍ≥Ñ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
@Scheduled(fixedRate = 600000) // 10Î∂ÑÎßàÎã§
public void updateClimbStatistics() {
    List<Long> activeUserIds = userRepository.findActiveUserIds();
    for (Long userId : activeUserIds) {
        updateUserClimbStats(userId);
    }
}
```

---

## ‚úÖ ÏÑ§Í≥Ñ ÏôÑÎ£å Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏

### ÏÇ¨Ïö©Ïûê ÌôúÎèô ÏóîÌã∞Ìã∞ (2Í∞ú)
- [x] **UserClimb** - ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù (ÏÉÅÏÑ∏ ÎèÑÏ†Ñ Í∏∞Î°ù, ÏÑ±Í≥º Î∂ÑÏÑù, ÌôòÍ≤Ω Ï†ïÎ≥¥)
- [x] **UserFollow** - ÌåîÎ°úÏö∞ Í¥ÄÍ≥Ñ (ÏÉÅÌò∏ ÌåîÎ°úÏö∞, ÌôúÏÑ±ÎèÑ Ï∂îÏ†Å, Í¥ÄÍ≥Ñ Í¥ÄÎ¶¨)

### ÏÉÅÏÑ∏ ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù ÏãúÏä§ÌÖú
- [x] ÌîåÎûòÏãú, Ïò®ÏÇ¨Ïù¥Ìä∏, Î†àÎìúÌè¨Ïù∏Ìä∏ Îì± ÌÅ¥ÎùºÏù¥Î∞ç ÌÉÄÏûÖ Î∂ÑÎ•ò
- [x] ÏãúÎèÑ ÌöüÏàò, ÏÑ±Í≥µÎ•†, ÏÜåÏöî ÏãúÍ∞Ñ ÏÉÅÏÑ∏ Í∏∞Î°ù
- [x] Ï≤¥Í∞ê ÎÇúÏù¥ÎèÑ, Ïû¨ÎØ∏, ÌíàÏßà 5Îã®Í≥Ñ ÌèâÍ∞Ä
- [x] Í∞úÏù∏ Í∏∞Î°ù ÏûêÎèô Ïù∏Ïãù Î∞è Ï∂îÏ†Å

### ÏÜåÏÖú ÌåîÎ°úÏö∞ ÏãúÏä§ÌÖú
- [x] ÏÉÅÌò∏ ÌåîÎ°úÏö∞ ÌôïÏù∏ Î∞è Í¥ÄÍ≥Ñ Í∞ïÎèÑ Í≥ÑÏÇ∞
- [x] ÌåîÎ°úÏö∞ ÏÜåÏä§ Ï∂îÏ†Å (Í≤ÄÏÉâ, Ï∂îÏ≤ú, ÎåìÍ∏Ä Îì±)
- [x] ÏπúÌïú ÏπúÍµ¨, Ï∞®Îã®, ÏùåÏÜåÍ±∞ Í¥ÄÎ¶¨
- [x] ÏÉÅÌò∏ÏûëÏö© ÎπàÎèÑ Î∞è ÌôúÏÑ±ÎèÑ Ï†êÏàò

### ÏÑ±Í≥º Î∂ÑÏÑù Í∏∞Îä•
- [x] ÏÑ±Í≥µÎ•†, ÎßåÏ°±ÎèÑ, Ïª®ÎîîÏÖò Ï†êÏàò Í≥ÑÏÇ∞
- [x] ÏõîÍ∞Ñ/Ïó∞Í∞Ñ ÌÅ¥ÎùºÏù¥Î∞ç ÌÜµÍ≥Ñ Î∂ÑÏÑù
- [x] Í∞úÏù∏ Í∏∞Î°ù Î∞è ÏÑ±Ïû• Ï∂îÏ†Å
- [x] ÌôòÍ≤Ω ÏöîÏù∏Î≥Ñ ÏÑ±Í≥º Î∂ÑÏÑù

### Ïª§ÎÆ§ÎãàÌã∞ Ïó∞Îèô
- [x] Í∏∞Î°ù Í≥µÍ∞ú/ÎπÑÍ≥µÍ∞ú ÏÑ§Ï†ï
- [x] ÌÅ¥ÎùºÏù¥Î∞ç ÌååÌä∏ÎÑà Í∏∞Î°ù Î∞è Î™©Í≤©Ïûê ÏãúÏä§ÌÖú
- [x] Ïª§ÎÆ§ÎãàÌã∞ Í≥µÏú† Î∞è ÏÜåÏÖú Í∏∞Îä•
- [x] Ìï®ÍªòÌïú ÌÅ¥ÎùºÏù¥Î∞ç ÌöüÏàò Ï∂îÏ†Å

### ÏÑ±Îä• ÏµúÏ†ÅÌôî
- [x] ÏÇ¨Ïö©ÏûêÎ≥Ñ ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù Ï°∞Ìöå ÏµúÏ†ÅÌôî
- [x] ÌåîÎ°úÏö∞ Í¥ÄÍ≥Ñ Í≤ÄÏÉâ Î∞è Ï∂îÏ≤ú Ïù∏Îç±Ïä§
- [x] ÌÜµÍ≥Ñ Ï†ïÎ≥¥ Ï∫êÏãú Ï†ÑÎûµ
- [x] Î∞∞Ïπò ÏûëÏóÖÏúºÎ°ú ÏÑ±Îä• ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏

---

**Îã§Ïùå Îã®Í≥Ñ**: step4-4c_system_final.md (ÏãúÏä§ÌÖú ÏµúÏ¢Ö ÏóîÌã∞Ìã∞ ÏÑ∏Î∂ÑÌôî)  
**ÏôÑÎ£åÏùº**: 2025-08-20  
**ÌïµÏã¨ ÏÑ±Í≥º**: 2Í∞ú ÏÇ¨Ïö©Ïûê ÌôúÎèô ÏóîÌã∞Ìã∞ + ÏÉÅÏÑ∏ ÌÅ¥ÎùºÏù¥Î∞ç Í∏∞Î°ù + ÏÜåÏÖú ÌåîÎ°úÏö∞ ÏãúÏä§ÌÖú + ÏÑ±Í≥º Î∂ÑÏÑù ÏôÑÏÑ±